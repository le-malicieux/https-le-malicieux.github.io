<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Le Malicieux - Catalogue R√©tro</title>
    <style>
        :root { --primary: #ff4757; --bg: #0f0f0f; --card-bg: #1a1a1a; --text: #eee; --header-bg: rgba(15,15,15,0.95); }
        
        /* STYLE WINDOWS XP */
        body.theme-xp { background: #245edb var(--bg-day) no-repeat center fixed; background-size: cover; --text: #000; }
        .theme-xp .card { background: #ece9d8 !important; border: 2px solid #0054e3 !important; border-radius: 5px 5px 0 0 !important; height: 520px; box-shadow: 4px 4px 0px rgba(0,0,0,0.2); }
        .theme-xp .win-title { background: linear-gradient(to bottom, #0058e6 0%, #0054e3 100%); color: white; padding: 4px 8px; display: flex; justify-content: space-between; font-weight: bold; font-size: 13px; }

        /* STYLE WINDOWS VISTA */
        body.theme-vista { background: #000 var(--bg-day) no-repeat center fixed; background-size: cover; --text: #fff; }
        .theme-vista .card { background: #1a1a1a !important; border: 1px solid #555 !important; border-radius: 8px 8px 0 0 !important; height: 520px; outline: 1px solid rgba(255,255,255,0.2); outline-offset: -2px; }
        .theme-vista .win-title { background: linear-gradient(to bottom, #444, #000); color: white; padding: 6px 10px; display: flex; justify-content: space-between; border-bottom: 1px solid #000; }

        /* BASES */
        body { font-family: 'Tahoma', sans-serif; margin: 0; padding: 20px; background-color: var(--bg); color: var(--text); }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 25px; }
        .card { text-decoration: none; color: inherit; display: flex; flex-direction: column; overflow: hidden; background: var(--card-bg); border: 1px solid #333; border-radius: 12px; }
        .card img { width: 100%; height: 260px; object-fit: cover; }
        .card-info { padding: 15px; }
        .card-title { font-weight: bold; color: var(--primary); margin-bottom: 10px; height: 2.5em; overflow: hidden; }
        .theme-xp .card-title { color: #000; }
        .controls { display: flex; gap: 10px; justify-content: center; margin-bottom: 30px; background: var(--header-bg); padding: 15px; border-radius: 12px; position: sticky; top: 10px; z-index: 100; }
        input, select, button { padding: 10px; border-radius: 5px; border: 1px solid #444; background: #222; color: white; cursor: pointer; }
    </style>
</head>
<body id="main-body">

    <div class="controls">
        <input type="text" id="search" placeholder="Rechercher...">
        <select id="theme-select" onchange="applyTheme(this.value)">
            <option value="default">Moderne</option>
            <option value="theme-xp">Windows XP</option>
            <option value="theme-vista">Windows Vista</option>
        </select>
        <button onclick="randomAnime()">üé≤ Al√©atoire</button>
    </div>

    <div id="anime-container" class="grid"></div>

    <script>
        let allAnimes = [];

        function applyTheme(theme) {
            const body = document.getElementById('main-body');
            body.classList.remove('theme-xp', 'theme-vista');
            if (theme !== 'default') {
                body.classList.add(theme);
                const d = new Date();
                const imgNum = (d.getDate() % 25) + 1;
                body.style.setProperty('--bg-day', `url('img/fond${imgNum}.jpg')`);
            }
            displayAnimes(allAnimes);
        }

        async function init() {
            const response = await fetch('animes.csv');
            const data = await response.text();
            const rows = data.split('\n').slice(1);
            allAnimes = rows.map(r => {
                const c = r.split(';');
                if (c.length < 5) return null;
                return { nom: c[0].replace(/"/g,''), score: c[2], sortie: c[3], img: c[c.length-1].trim() };
            }).filter(a => a);
            displayAnimes(allAnimes);
        }

        function displayAnimes(list) {
            const container = document.getElementById('anime-container');
            container.innerHTML = "";
            const isRetro = document.getElementById('theme-select').value !== 'default';
            list.forEach(a => {
                const card = document.createElement('a');
                card.className = 'card';
                card.href = `video.html?name=${encodeURIComponent(a.nom)}`;
                card.innerHTML = `
                    ${isRetro ? `<div class="win-title"><span>${a.nom.slice(0,15)}</span><span>_ ‚ñ° X</span></div>` : ''}
                    <img src="img/${a.img}" onerror="this.src='https://via.placeholder.com/240x260'">
                    <div class="card-info">
                        <div class="card-title">${a.nom}</div>
                        <div>‚≠ê ${a.score} | üìÖ ${a.sortie}</div>
                    </div>`;
                container.appendChild(card);
            });
        }

        document.getElementById('search').addEventListener('input', e => {
            const val = e.target.value.toLowerCase();
            displayAnimes(allAnimes.filter(a => a.nom.toLowerCase().includes(val)));
        });

        function randomAnime() {
            const a = allAnimes[Math.floor(Math.random()*allAnimes.length)];
            window.location.href = `video.html?name=${encodeURIComponent(a.nom)}`;
        }
        init();
    </script>
</body>
</html>
