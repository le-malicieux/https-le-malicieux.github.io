<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visionnage - Anime</title>
    <style>
        :root { --primary: #ff4757; --bg: #0f0f0f; --text: #eee; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; }
        .back-btn { display: inline-block; padding: 10px 20px; background: var(--primary); color: white; text-decoration: none; border-radius: 5px; margin-bottom: 20px; font-weight: bold; }
        .video-container { width: 100%; aspect-ratio: 16/9; background: #000; border-radius: 10px; overflow: hidden; margin-bottom: 20px; border: 1px solid #333; }
        iframe { width: 100%; height: 100%; border: none; }
        .details { display: flex; gap: 20px; flex-wrap: wrap; background: #1a1a1a; padding: 20px; border-radius: 10px; }
        .details img { width: 200px; border-radius: 10px; }
        .info { flex: 1; min-width: 300px; }
        .tag { background: #333; padding: 5px 10px; border-radius: 15px; font-size: 0.8em; margin-right: 5px; }
        h1 { color: var(--primary); margin-top: 0; }
        p { line-height: 1.6; color: #bbb; }
    </style>
</head>
<body>

    <div class="container">
        <a href="index.html" class="back-btn">‚Üê Retour au catalogue</a>
        
        <div id="content">
            <p>Chargement de l'√©pisode...</p>
        </div>
    </div>

    <script>
        const clean = (str) => (str || "").replace(/^"|"$/g, "").trim();
        
        async function loadVideo() {
            // 1. R√©cup√©rer le nom de l'anime dans l'URL (?name=...)
            const params = new URLSearchParams(window.location.search);
            const animeName = params.get('name');

            if (!animeName) {
                document.getElementById('content').innerHTML = "Anime non trouv√©.";
                return;
            }

            // 2. Charger le CSV pour trouver les infos
            const response = await fetch('animes.csv');
            const data = await response.text();
            const rows = data.split(/\r?\n/).slice(1);
            
            let found = null;
            for(let row of rows) {
                let c = row.split(';');
                if (clean(c[0]) === animeName) {
                    found = {
                        nom: clean(c[0]),
                        score: clean(c[2]),
                        episodes: clean(c[4]),
                        desc: clean(c[7]),
                        img: clean(c[8]),
                        video: clean(c[9]) // Ton lien Streamtape
                    };
                    break;
                }
            }

            if (found) {
                document.title = "Regarder " + found.nom;
                // Si le lien est un lien streamtape classique, on le transforme en lien embed
                let videoSrc = found.video;
                if(videoSrc.includes('streamtape.com/v/')) {
                    videoSrc = videoSrc.replace('/v/', '/e/');
                }

                document.getElementById('content').innerHTML = `
                    <div class="video-container">
                        <iframe src="${videoSrc}" allowfullscreen></iframe>
                    </div>
                    <div class="details">
                        <img src="img/${found.img}" onerror="this.src='https://via.placeholder.com/200x300'">
                        <div class="info">
                            <h1>${found.nom}</h1>
                            <p><span class="tag">‚≠ê ${found.score}/10</span> <span class="tag">üì∫ ${found.episodes}</span></p>
                            <p>${found.desc}</p>
                        </div>
                    </div>
                `;
            } else {
                document.getElementById('content').innerHTML = "D√©sol√©, impossible de trouver les donn√©es de cet anime.";
            }
        }

        loadVideo();
    </script>
</body>
</html>
